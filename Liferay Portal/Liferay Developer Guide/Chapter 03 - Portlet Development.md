# Chapter 03 - Portlet Development

## Creating a Portlet
* Navigate to the **portlets** directory
* $ ./create.sh my-greeting "My Greeting"

## Deploying the Portlet
* $ ant deploy
* Add -> More

## Anatomy of a Portlet
* A portlet project is made up for at least three components:
    * Java Source
    * Configuration files
    * Client-side files (.jsp, .css, graphics files, etc...)
* Standard directory structure:
    * PORTLET-NAME/
        * build.xml
        * docroot/
            * css/
            * js/
            * WEB-INF/
                * src/  - this folder is not created by default
                * liferay-display.xml
                * liferay-plugin-package.properties
                * liferay-portlet.xml
                * portlet.xml
                * web.xml - this file is not created by default
            * icon.png
            * view.jsp
* By default, new portlets use the MVCPortlet framework
* Each of the registered portlet modes has a corresponding JSP
* The **Java Source** is stored in the *docroot/WEB-INF/src*
* The **Configuration Files** are stored in the *docroot/WEB-INF*
* liferay-display.xml - describes the category the portlet appears under the *Add* menu of the Dockbar
* liferay-portlet.xml - describes Liferay-specific enhancements for JSR-286
* liferay-plugin-package.properties - describes the plugin to Liferay's hot deployer
* **Client Side Files** should go in the docroot folder

## A Closer Look at the My Greeting Portlet
* **docroot/WEB-INF/portlet.xml**
* portlet-name: contains the portlet's canonical name, also referred to as the portlet ID
* display-name: contains a short name that's shown by the portal
* portlet-class: contains the fully qualified name of the class that handles invocations to the portlet
* init-param: contains a name/value pair as an initialization parameter of the portlet
* expiration-cache: the time, in seconds, after which the portlet output expires, -1 means never expires
* supports: contains the supported MIME-type
* portlet-info: defines information that can be used for the portlet title-bar and for the portal's categorization of the portlet
* use resource-bundle to support internalization
* security-role-ref: contains the declaration of a security role reference in the code of the web application
* **docroot/WEB-INF/liferay-portlet.xml**: optional Liferay specific enhancements for java Standard portlets
* portlet-name: canonical name of the portlet, this have to be same as the portlet-name specified in the *portlet.xml* file
* icon: path to icon image for this portlet
* instanceable: indicates whether multiple instances of this portlet can appear on the same page
* header-portlet-css: path to the .css file to include in the *head* tag
* footer-portlet-javascript: the path to the .js file, to be included end the end of the page before the *body* tag

## Writing the My Greeting Portlet
* Make our portlet do something useful:
    * view.jsp: display the greeting and provides a link to the *edit* page
    * edit.jsp: shows a form with a text field
* Set portlet to instanceable to false
* The URL must always go to the portal responsible for rendering
* The **portlet:defineObjects** tag makes the following portlet objects available to a JSP:
    * RenderRequest represents the request sent to the portlet to handle a render
    * ResourceRequest
    * ActionRequest
    * EvenRequest
    * RenderResponse
    * ResourceResponse
    * ActionResponse
    * EventResponse
    * PortletConfig
    * PortletSession
    * PortletPreferences

## Understanding the Two phases of Portlet Execution
* The portlet specification defines two phases for every request of a portlet, allowing the portal to differentiate *when an action is being performed* (and should not be repeated) and *when the content is being produced* (render):
    * **Action phase**: the action phase can only be invoked for one portlet at a time
    * **Render phase**: the render phase is always invoked for all portlets on the page after the action phase. Portlets with higher render weight will be rendered before those with a lower weight
* There are three types of URLs can be generated by a portlet:
    * *renderURL*: invokes a portlet using only its render phase
    * *actionURL*: executes an action phase before rendering all the portlets in the page
    * *resourceURL*: is used to retrieve images, XML, JSON or any other type of resource

## Passing Information from the Action Phase to the Render Phase
* There are two ways to pass information from the action phase to the render phase:
    * Through render parameters: **setRenderParameter** on actionResponse, and read from renderRequest.Copy all action parameters as render parameters: **init-param** set **copy-request-parameters** to true
    * Using the session: set an attribute in the **actionRequest** that is then read from the JSP

## Developing a Portlet with Multiple Actions
* Add method to the class match action name

## Adding Friendly URL Mapping to the Portlet
* Edit **liferay-portlet.xml**, and after icon and before instanceable
    * friendly-url-mapper-class
    * friendly-url-mapping
    * friendly-url-routes

## Localizing your Portlet
