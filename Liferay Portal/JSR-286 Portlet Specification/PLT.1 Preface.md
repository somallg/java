# PLT.1 Preface

## PLT.1.1 Additional Sources
* The specification is intended to be ca complete and clear explanation of Java portlets, but questions remain the following may be consulted:
    * A reference implementation (RI). Where the specification leaves implementation of a particular feature open to interpretation, implementator may use the reference implementation as a model of how to carry out the intention of the spec
    * A Technology Compatibility Kit (TCK): for accessing whether implementations meet tho compatibility requirements of the Java Portlets API
    * If further clarification is required, the working group of the Java Portlet API under the Java Community Process should be consulted

## PLT.1.2 Who Should Read This Specification
* Portal server vendors that want to provide portlet containers that conform to this standard
* Authoring tool developers that want to support web applications that conform to this specification
* Experienced portlet authors who want too understand the underlying mechanisms of portlet technology

## PLT.1.3 API Reference
* An accompanying javadoc, includes the full specification of class, interfaces, and method signatures

## PLT.1.4 Other Java Platform Specifications
* Java 2 Platform, EE
* Java Servlet
* JavaServer Pages
* The Java Architecture for XML Binding (JAXB)

## PLT.1.5 Other Important References
* RFC 1630 Uniform Resource Identifiers (URI)
* RFC 1766 Tags for the Identification of Languages
* RFC 1738 Uniform Resource Locators (URL)
* RFC 2396 Uniform Resource Identifiers (URI): Generic Syntax
* RFC 1808 Relative Uniform Resource Locators
* RFC 1945 Hypertext Transfer Protocol (HTTP/1.0)
* RFC 2045 MIME Part One: Format of Internet Message Bodies
* RFC 2046 MIME Part Two: Media Types
* RFC 2047 MIME Part Three: Message Header Extensions for non-ASCII text
* RFC 2048 MIME Part Four: Registration Procedures
* RFC 2049 MIME Part Five: Conformance Criteria and Examples
* RFC 2109 HTTP State Management Mechanism
* RFC 2145 Use and Interpretation of HTTP Version Numbers
* RFC 2616 Hypertext Transfer Protocol (HTTP/1.1)
* RFC 2617 HTTP Authentication: Basic and Digest Authentication
* ISO 639 Code for the representation of names of languages
* ISO 3166 Code (Country) list
* OASIS Web Services for Remote Portlets (WSRP)
* CC/PP Processing, JSR 188
* W3C: Composite Capability/Preference Profiles (CC/PP): Structure and Vocabularies

## PLT.1.6 Terminology

## PLT.1.7 Providing Feedback

## PLT.1.8 Acknowledgements V 2.0

## PLT.1.9 Acknowledgements V 1.0

## PLT.2 Overview

## PLT.2.1 What is a Portal?
* A Portal is a Web based application that - commonly - provides personalization, authentication, content aggregation from different sources and hosts the presentation layer of information systems
* Aggregation is the action of integrating content from different sources within a web page
* Portal pages may have different set of portlets creating content for different users

## PLT.2.2 What is a Portlet?
* A Portlet is an application that provides a specific piece of content (information or service) to be included as part of a portal page
* A Portlet is managed by a Portlet Container, that processes requests and generates dynamic content
* Portlets are used by Portals as pluggable user interface components that provides a presentation layer of information systems
* The content generated by a Portlet is also called a fragment (a piece of markup adhering to certain rules and can be aggregated with other fragments to from a complete document)
* The content of a Portlet is normally aggregated with the content of other Portlets to form the Portal page
* The lifecycle of a Portlet is managed by the Portlet Container
* Web Clients interact with portlets via a Request/Response paradigm implemented by the Portal
* Normally, users interact with content produced by Portlets, for example by following links or submitting forms, resulting in Portlets actions being received by the Portal, which are forwarded by it to the portlets targeted by the user's interactions
* The content generated by a Portlet may vary from one user to another depending on the user configuration for the Portlet

## PLT.2.3 What is a Portlet Container?
* A Portlet Container runs Portlets and provides them with the required runtime environment
* A Portlet Container contains Portlets and manages their lifecycle
* It also provide persistent storage for Portlet Preferences
* A Portlet Container receives requests from the Portal to execute requests on the portlets hosted by it
* A Portlet Container is not responsible for aggregating the content produced by the Portlets. It is the responsibility of the Portal to handle the aggregation
* A Portal and Portlet Container can be built together as a single component of an application suite or as two separate components of a portal application

## PLT.2.4 An Example
* A typical sequence of events, initiated when users access their portal page:
    * A client after being authenticated makes an HTTP request to the Portal
    * The request is received by the Portal
    * The Portal determines if the request contains an action targeted to any of the Portlets associated with the Portal page
    * If there is an action targeted to a Portlet, the Portal request the Portlet Container to invoke the Portlet to process the action
    * A Portal invokes Portlets, through the Portlet Container, to obtain content fragments that can be included in the resulting Portal page
    * The Portal aggregates the output of the Portlets in the Portal page and sends the Portal page back to the client

## PLT.2.5 Compatibility
* Portlet v2 Containers must support deploy JSR 168 Portlets and the JSR 168 Deployment Descriptor
* The only exceptions to this rule are:
    * *RenderResponse.setContentType* is no longer required before calling *getWriter* or *getOutPutStream*
    * *getProtocol* for included servlets / JSP no longer returns *null* but 'HTTP/1.1' in v2.0

## PLT.2.6 Major changes introduced with v2.0
* The major new features of version 2.0 include:
    * Events - enabling a Portlet to send and receive events and perform state changes or send further events as a result of processing an event
    * Public render parameters - allowing portlets to share parameters with other Portlets
    * Resource serving - provide the ability for a Portlet to serve a Resource
    * Portlet filter - allowing on-the-fly transformations of information in both the request and response from a portlet

### PLT.2.6.1 Clarifications that may make v1.0 Portlets non-compliant    
* Depending on the implementation of the Portlet of a specific runtime behavior of a Portlet Container the following clarifications may lead to different results when executing a Portlet in either a JSR 168 or a JSR 286 Container:
    * XML escaping of Portlet URLs produced via the portlet tag library. v2.0 clarifies that the defaults is all portlet URL are XML escaped
    * Defining multiple values for the same parameter name in the Portlet *param* tag. v2.0 clarifies that if the same name of a parameter occurs more than once within an *actionURL*, *renderURL*, or *resourceURL* the values must be delivered as parameter value array with the values in the order of the declaration within the URL tag. Portlets assuming that the last occurrence wins and replaces the previous set values
    * *getProtocol* for included servlets / JSPs no longer returns *null*. v2.0 defines that getProtocol now returns 'HTTP/1.1' and thus is better aligned with the servlet model that expects the *getProtocol* to return this value in the *GenericServlet*
    * Parameters set on the portlet URL and the post body are aggregated into the request parameter set. Portlet URL parameters are presented before post body data
    * *RenderResponse.setContentType* is no longer required before calling *getWriter* or *getOutPutStream*. Calling *getWriter* or *getOutputStream* without previously setting the content type will no longer result in an IllegalStateException

### PLT.2.6.2 Changes to the Programming Model 
* The following additions were made to the v1.0 Programming model:
   * Use application level resource bundles instead of inline localization in the *portlet.xml*
   * In v1.0 the only ability to localize values on the portlet application level was inside the *portlet.xml* using xml:lang attributes. With v2.0 Portlet application developers can now provide the localized values in a resource bundle and thus have the localized values in separate files instead of cluttering the deployment descriptor

### PLT.2.6.3 List of all Changes in the Specification

### PLT.2.6.4 List of all API changes
* ActionRequest:
    * extends ClientDataRequest
    * added ACTION_NAME constant
    * added getMethod
* ActionResponse:
    * extends StateAwareResponse
    * added sendRedirect(String, String)
* added new BaseURL interface
* added new CacheControl interface
* added new Event interface
* added new EventInterface interface
* added new Event
* GenericPortlet
    * implements ResourceServingPortlet, EventPortlet
    * added new PortletConfig methods
    * add doHeaders method
    * added getNextPossiblePortletModes method
* added new MimeResponse interface
* PortalContext
    * added constant MARKUP_HEAD_ELEMENT_SUPPORT
* PortletConfig
    * added getPublicRenderParameterNames method
    * added getDefaultNamespace method
    * added getPublishingEventQNames method
    * added getProcessingEventQNames method
    * added getSupportedLocales method
    * added getContainerRuntimeOptions method
* PortletContext
    * added getContainerRuntimeOptions method
* PortletRequest
    * added constants CCPP_PROFILE, ACTION_PHASE, EVENT_PHASE, RENDER_PHASE, RESOURCE_PHASE, LIFECYCLE_PHASE, RENDER_PART, RENDER_HEADERS, RENDER_MARKUP, ACTION_SCOPE_ID
    * added enum P3PUserInfos
    * added getWindowID method
    * added getCookies method
    * added getPrivateParameterMap method
    * added getPublicParameterMap method
* PortletRequestDispatcher
    * added included(PortletRequest, PortletResponse) method
    * added forward method
* PortletResponse
    * changed getNamespace: lifetime is now for the portlet window instead just request
    * added addProperty(javax.servlet.http.Cookie) method
    * added addProperty(String, org.w3c.dom.Element) method
    * added createElement method
* PortletSession
    * added getAttributeMap() method
    * added getAttributeMap(int) method
* PortletURL
    * extends BaseURL
    * added add/setProperty methods
    * added getParameterMap
    * added writer methods
    * added getPortletMode method
    * added getWindowState
    * added removePublicRenderParameter method
* added PortletURLGenerationListener interface
* added ProcessAction annotation
* added ProcessEvent annotation
* added RenderMode annotation
* RenderRequest
    * added constant ETAG
    * added getETag method
* RenderResponse
    * extends MimeResponse
    * added constants CACHE_SCOPE, PUBLIC_SCOPE, PRIVATE_SCOPE, ETAG, USE_CACHED_CONTENT, NAMESPACED_RESPONSE, MARKUP_HEAD_ELEMENT
    * added createResourceURL method
    * added getCacheControl method
    * added setNextPossiblePortletModes method
* added ResourceRequest interface
* added ResourceResponse interface
* added ResourceServingPortlet interface
* added ResourceURL interface
* added StateAwareResponse interface
* added javax.portlet.filter package
    * added ActionFilter package
    * added ActionRequestWrapper class
    * added ActionResponseWrapper class
    * add EventFilter interface
    * added EventRequestWrapper class
    * added EventResponseWrapper class
    * added FilterConfig interface
    * added FilterChain interface
    * added PortletFilter interface
    * added PortletRequestWrapper class
    * added PortletResponseWrapper class
    * added RenderFilter interface
    * added RenderResponseWrapper class
    * added ResourceFilter interface
    * added ResourceRequestWrapper class
    * added ResourceResponseWrapper class

## PLT.2.7 Relationship with Java 2 Platform, Standard and Enterprise Edition
* The Portlet API v2.0 is based on the Java Platform, SE 5.0 and EE v1.4. Portlet container should at least meet the requirements, described in v1.4 of the J2EE Spec
* As Portlet API v2.0 is intended to enable a common, composable programming model for web development with broad applicability
* The following Java SE 5.0 features will not be available in the Portlet API v2.0 compiled for Java EE 1.4:
    * enum P3PUserInfos
    * annotations ProcessAction, ProcessEvent, RenderMode
    * generics for collections
* Due to the analogous functionality of Servlets, concepts, names and behavior of the Portlet will be similar to the ones defined in the *Servlet Specification 2.4* whenever applicable

## PLT.3 Relationship with the Servlet Specification
* The *Servlet Specification* defines Servlets as follow:
    * A Servlet is a Java technology based Web Component, managed by a Container, that generates dynamic content. Like other Java-based components, servlet are platform independent Java classes that are compiled to platform neutral bytecode that can be loaded dynamically into and run by a Java enabled Web Server. Containers, sometimes called Servlet Engines, are Web Server extensions that provide Servlet functionality. Servlets interact with web clients via a request/response paradigm implemented by the Servlet Container
* Portlets share many similarities with Servlets:
    * Portlets are Java based web components
    * Portlets are managed by a specialized container
    * Portlets generate dynamic content
    * Portlets lifecycle is managed by a container
    * Portlets interact with web client via a request/response paradigm
* Portlets differ in the following aspect from Servlets:
    * Portlets only generate markup fragments in the Render method, not complete documents. The Portal aggregates Portlet markup fragments into a complete Portal page
    * Portlets can only be invoked through URLs constructed via the portlet API
    * Web client interact with portlets through a portal system
    * Portlets have more refined request handling, i.e action requests, event request, render request and resource requests
    * Portlet have predefined portlet modes and window states that indicate the function the portlet is performing and the amount of real estate in the Portal page
    * Portlets can exists many times in a Portal page
* Portlets have access to the following extra functionality not provided by Servlets:
    * Portlets have a means of accessing and storing persistent configuration and customization data
    * Portlet have access to user profile information
    * Portlets have URL rewriting functions for creating hyperlinks within their content, which allow portal server agnostic creation of links and actions in page fragments
    * Portlets can store transient data in the portlets session in two different scopes: Application-wide Scope and Portlet private scope
    * Portlets can send and receive events from other portlets or can receive container defined events
* Portlets do not have access to the following functionality provided by servlets:
    * Setting the character set encoding of the render response
    * The URL of the client request to the Portal
* The Portlet have full control over the response when rendering resources via the *serveResource* call
* In order to reuse as much as possible of the existing servlet infrastructure, the Portlet Specification leverages functionality provided by the Servlet Specification wherever possible. This includes deployment, classloading, web applications, web application lifecycle management, session management and request dispatching. Many concepts and parts of the Portlet API have been modeled after the Servlet API
* Portlets, Servlets, and JSPs are bundled in an extended web application called a Portlet Application. Portlets, Servlets and JSPs within the same Portlet Application share the classloader, application context and session

## PLT.3.1 Bridging from Portlets to Servlets/JSPs
* Portlets can leverage Servlets, JSPs and JSP tag-libraries for generating content
* A Portlet can call Servlets and JSPs just like a Servlet can invoke other Servlets and JSPs using a request dispatcher. To enable a seamless integration between portlets and servlets the Portlets Specification leverages many of the servlet objects
* When a Servlet or JSP is called from within a Portlet, the Servlet Request given to the Servlet or JSP is based on the Portlet Request and the Servlet Response given to the Servlet or JSP is based on the Portlet Response:
    * Attributes set in the Portlet request are available in the included Servlet request
    * The Portlet and the included Servlet or JSP share the same output stream
    * Attributes set in the Portlet session are accessible from the Servlet session and vice-versa

## PLT.3.2 Using Servlet Application Lifecycle Events
* Java Servlet Specification describes a variety of application lifecycle events that the Servlet can register for. The following Portlets objects defined by this spec mirror its Servlet counterparts: *PortletContext* and *PortletSession*. Due to this fact the Servlet lifecycle listeners for *ServletContext* and *HttpSession* can also be used for notifications on the *PortletContext* and *PortletSession*
* Given that Portlet request is independent of the Servlet Request the Servlet Request lifecycle listeners do not have a simple mapping to portlet requests. In order to allow Portlets to leverage the Servlet Request listeners for Portlets, the Portlet Container needs to create a Servlet Request mirroring the Portlet Request. In order to allow the Servlet Request listeners to distinguish between the case of a plain Servlet Request and a Servlet Request targeted towards a Portlet, the Portlet Container needs to set the attribute *javax.portlet.lifecycle_phase* in order to mark this request as a request targeted to a Portlet
* The following is the list of servlet listeners that also apply to Portlets:
    * *javax.servlet.ServletContextListener*: for notifications about the Servlet context and the corresponding Portlet context
    * *javax.servlet.ServletContextAttributeListener*: for notifications on attributes in the Servlet Context or the corresponding Portlet context
    * *javax.servlet.http.HttpSessionActivationListener*: for notifications on the activation or passivation of the *HTTPSession* or *PortletSession*
    * *javax.servlet.http.HttpSessionAttributeListener*
    * *javax.servlet.http.HttpSessionBindingListener*: for notifications on binding of object to the *HTTPSession* or *PortletSession*
    * *javax.servlet.ServletRequestListener*: for notifications about changes to *HTTPServletRequest* or mirrored Portlet Request
    * *javax.servlet.ServletRequestAttributeEvent*: for notifications about changes to the attributes of the *HTTPServletRequest* or mirrored Portlet Request

## PLT.3.3 Relationship Between the Servlet Container and the Portlet Container
* Portlet Container is an extension of the Servlet Container. As such, a Portlet Container can be built on top of an existing Servlet Container or it may implement all the functionality of a Servlet Container
    
    



