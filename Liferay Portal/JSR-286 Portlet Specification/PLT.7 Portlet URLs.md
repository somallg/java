# PLT.7 Portlet URLs
* As part of its content, a Portlet may need to create URLs that reference the Portlet itself. For example, when a user acts on a URL that references a Portlet (i.e, by clicking a link or submitting a form) the result is a new client request to the portal targeted to the Portlet. Those URLs are called Portlet URLs

## PLT.7.1 Portlet URLs
* The Portlet API defines the *PortletURL* and *ResourceURL* interface. Portlets must create Portlet URLs either using *PortletURL* or *ResourceURL* objects. 
* A Portlet creates *PortletURL/ResourceURL* object invoking the *createActionURL*, *createRenderURL* or the *createResourceURL* method of the *PortletResponse* interface. 
* The *createActionURL* method creates action URLs. The *createRenderURL* method creates render URLs. The *createResourceURL* method creates resource URLs
* A render URL is an optimization for a special type of action URLs. The portal/portlet-container must not invoke the *processAction* method of the targeted portlet of a render URL
* The portal/portlet-container must ensure that all the parameters set when constructing the render URL become render parameters of the subsequent render requests for the portlet
* Render URLs should not be used for tasks that are not idempotent, i.e that change state, from the portlet perspective. Error conditions, cache expirations and changes of external data may affect the content generated by a portlet as result of a request triggered by a render URL. 
* Render URLs should be accessible via HTTP method GET as they should not change any state on the server. As a consequence, render URLs may become bookmarkable
* Note that Render URLs used within forms may not work on all portal/portlet-containers as the portal/portlet-container may ignore form parameters
* A resource URL allows the Portlet serving resources with access to information of the portlet request. When rendering resources the portlet has full control over the output stream and can render binary markup
* Note that Portlet URLs are only valid within the current request and need to be either written to the output stream in order to allow re-writing the Portlet URL token into a real URL

### PLT.7.1.1 BaseURL interface
* The *BaseURL* interface provides the basic methods that are common for all URLs pointing back to the portlet, like *ResourceULRs*, *ActionURLs*, and *RenderURLs*. *BaseURL* are always created either as resource URL, action URL, or render URL
* Portlets can add application specific parameters to the *BaseURL* objects using the *setParameter* and *setParameters* methods. A call to any of the *setParameter* methods must replace any parameter with the same name previously set. All the parameters a Portlet adds to a *BaseURL* object must be made available to the portlet as request parameters. 
* The portlet-container must "x-www-form-urlencoded" encode parameter names and values added to a *BaseURL* object
* The portlet container will not remove any namespacing the Portlet has done on these parameters
* If the portal/portlet container encodes additional information as parameters, it must namespace them properly to avoid collisions with parameters set and used by the Portlet
* If the Portlet wants to include a Portlet URL in the Portlet content it should use the *write* method and avoid the string object creation of the *toString* method
* Portlet developers should be aware that the string representation of a *PortletURL* or *ResourceURL* may not be a well formed URL but a special token at the time the portlet is generating its content. Portal servers often use a technique called URL rewriting that post-processes the content resolving tokens into real ULRs. It may even be an ECMA script method that may generate the URL at the time the user clicks on the link

#### PLT.7.1.1.1 URL Properties
* Properties can be used by Portlets to set vendor specific information on the PortletURL object and thus extended URL capabilities
* A Portlet can set properties using the following methods of the *BaseURL* interface:
    * setProperty (replace old values)
    * addProperty

### PLT.7.1.2 Including a Portlet Mode or a Window State
* A Portlet URL can include a specific Portlet mode or window state. *PortletURL* interface has the *setWindowSate* and *setPortletMode* methods for settings the Portlet mode and window state in the Portlet URL
* A Portlet cannot create a Portlet URL using a Portlet mode that is not defined as supported by the Portlet or that the user it is not allowed to use. The *setPortletMode* methods must throw a *PortletModeException* in that situation
* The change of Portlet mode must be effective for the request trigger by the Portlet URL. There are some exceptional circumstances, such as changes in access control privileges that could prevent the Portlet mode change from happening
* If the Portlet mode is not set for a URL, it must have the Portlet mode of the current request as default
* A Portlet cannot create a Portlet URL using a window state that is not supported by the Portlet container. The *setWindowState* method must throw a *WindowStateException* if that is the case
* The change of window state should be effective for the request triggered by the Portlet URL. The Portlet should not assume that the request triggered by the Portlet URL will be in the window state set as the portal/portlet-container could override the window state because of implementation dependencies between Portlet modes and window states. If the window state is not set for a URL, it must have the window state of the current request as default

### PLT.7.1.3 Portlet URL Security
* The *setSecure* method of the *PortletURL* interface allows a Portlet to indicate if the Portlet URL has to be a secure URL or not (i.e. HTTPS or HTTP)
* If the *setSecure* method is not used, the Portlet URL should be of the same security level of the current request
* If *setSecure* is called with *true*, the transport for the request triggered with this URL must be secure (i.e HTTPS)
* If set to *false*, the Portlet indicates that it does not require a secure connection for the request triggered with such URL

## PLT.7.2 Portlet URL listeners
* Portlets can register Portlet URL listeners in order to filter URLs before they get generated either as a string via the *toString method* or written to the output stream via the *write* method of the *BaseURL* interface. The Portlet URL listener is also called for a render URL that is added to a redirect URL via the method *sendRedirect(location, renderUrlParamName)
* The Portlet could use URL listeners to set the caching level of resource URLs in out central piece of code
* In order to receive a callback from the Portlet Container before a portlet URL is generated, the listener class needs to implement the *PortletURLGenerationListener* interface and register it in the deployment descriptor

### PLT.7.2.1 PortletURLGenerationListener Interface
* The *PortletURLGenerationListener* interface provides callbacks for each Portlet URL type. If the Portlet application has specified one or more *PortletURLGenerationListener* classes in the Portlet deployment descriptor, the Portlet Container must call:
    * the method *filterActionURL* method for all action URLs before executing the *write* or *toString* method of these action URLs
    * the method *filterRenderURL* method for all render URLs before executing the *write* or *toString* method of these render URLs
    * the method *filterResourceURL* method for all resource URLs before executing the *write* or *toString* method of these resource URLs
* The Portlet Container must provide the *PortletURL* or *ResourceURL* to generate to the filter methods and execute the *write* or *toString* method on the updated *PortletURL* or *ResourceURL* that is the outcome of the filter method call

### PLT.7.2.2 Registering Portlet URL Listeners
* Portlet applications must register Portlet URL listener in the portlet deployment descriptor under the application section with the *listener* element and provide the class name that implements the *PortletURLGenerationListener* as value in the *listener-class*
* If more than one listener is registered the portlet container must chain the listeners in the order of how they appear in the deployment descriptor
