# 5. Being a Web App
* Objectives - The Web Container Model
    * 3.1 For the servlet and ServletContext initialization parameters: write servlet code to access initialization parameters, and create deployment descriptor elements for declaring initialization parameters
    * 3.2 For the fundamental servlet attribute scopes (request, session, and context): write servlet code to add, retrieve, and remove attributes; given a usage scenario, identify the proper scope for an attribute; and identify multi-threading issues associated with each scope
    * 3.3 Describe the element of the Web container request processing model: Filter, Filter chain, Request and response wrappers, and Web resource (servlet or JSP page)
    * 3.4 Describe the Web Container lifecycle event model for requests, session, and web applications; create and configure listener classes for each scope life cycle; create and configure scope attribute listener classes; and given a scenario, identify the proper attribute listener to use
    * 3.5 Describe the RequestDispatcher mechanism; write servlet code to create a request dispatcher; write servlet code to forward or include the target resource; and identify the additional request-scoped attributes provided by the container to the target resource

## Init Parameters to the rescue

## You cant use servlet init parameters until the servlet is *initialized*
* When the Container initializes a servlet, it makes a unique ServletConfig for the servlet
* The containers *reads* the servlet init parameters from the DD and gives them to the ServletConfig, then passes the ServletConfig to the servlet init() method

## The servlet init parameters are read only ONCE - when the container initializes the servlet

## Testing your ServletConfig
* ServletConfig API:
    * getInitParameter(String)
    * Enumeration getInitParameterNames()
    * getServletContext()
    * getServletName()

## How can a JSP get servlet init parameters?
* A ServletConfig is for *servlet* configuration. So you want *other* parts of your application to use the same info you put in the servlet init parameters in the DD, you need something more

## Setting a request attribute works.. but only for the JSP to which you forwarded the request

## Context init parameters to the rescue
* *Context* init parameters work just like *servlet* init parameters, except context parameters are available to the entire web app, not just a single servlet

## Remember the difference between servlet init parameters and context init parameters

## ServletConfig is one per servlet. ServletContext is one per web app

## So what else can you do with your ServletContext?
* Interface ServletContext
    * getInitParameter(String)
    * getInitParameterName()
    * getAttribute(String)
    * getAttributeNames()
    * setAttribute(String, Object)
    * removeAttribute(String)
    * getRequestDispatcher(String)

## What if you want an app init parameter that a database DataSource?

## She wants a ServletContextListener
* To listen for ServletContext events, write a listener class that implements ServletContextListener, put it in your WEB-INF/classes directory, and tell the Container by putting a *listener* element in the Deployment Descriptor

## Listeners: not just for servlet context...

## The eight listeners
* javax.servlet.ServletContextAttributeListener
    * ServletContextAttributeEvent
    * attributeAdded
    * attributeRemoved
    * attributeReplaced
* javax.servlet.http.HttpSessionListener
    * HttpSessionEvent
    * sessionCreated
    * sessionDestroyed
* javax.servlet.ServletRequestListener
    * ServletRequestEvent
    * requestInitialized
    * requestDestroyed
* javax.servlet.ServletRequestAttributeListener
    * ServletRequestAttributeEvent
    * attributeAdded
    * attributeRemoved
    * attributeReplaced
* javax.servlet.http.HttpSessionBindingListener
    * HttpSessionBindingEvent
    * valueBound
    * valueUnbound
* javax.servlet.http.HttpSessionAttributeListener
    * HttpSessionBindingEvent
    * attributeAdded
    * attributeRemoved
    * attributeReplaced
* javax.servlet.ServletContextListener
    * ServletContextEvent
    * contextInitialized
    * contextDestroyed
* javax.servlet.http.HttpSessionActivationListener
    * HttpSessionEvent
    * sessionDidActivate
    * sessionWillPassivate

## The HttpSessionBindingListener
* HttpSessionAttributeListener is just a class that wants to know when *any* type of attribute has been added, removed, or replaced in a Session
* HttpSessionBindingListener exists so that the attribute *itself* can find out when *it* has been added to or removed from a Session

## What, exactly, is an attribute?
* An attribute is like an object pinned to an bulletin board. Somebody stuck it on the board so that others can get it

## Attributes are not parameters!

## The Three Scopes: Context, Request, and Session

## Attribute API
* Object getAttribute(String)
* void setAttribute(String, Object)
* void removeAttribute(String)
* Enumeration getAttributeNames()

## The dark side of attributes...
  
## Context scope isn't thread-safe!
    
## How do we make context attributes thread-safe?
    
## Synchronizing the service method is a spectacularly BAD idea
    
## Synchronizing the service method won't protect a context attribute!

## You don't need a lock on the request... you need the lock on the context!
    
## Are Session attributes thread-safe?

## Protect session attributes by synchronizing on the HttpSession

## SingleThreadModel is designed to protect instance variables
* No two threads will execute concurrently in the servlet's service method

## Only Request attributes and local variables are thread-safe!

## Request attributes and Request dispatching

## RequestDispatcher revealed
* RequestDispatchers have only two methods- *forward* and *include*
* Getting a RequestDispatcher from a ServletRequest
    * request.getRequestDispatcher("result.jsp")
* Getting a RequestDispatcher form a ServletContext
    * getServletContext().getRequestDispatcher("/result.jsp")
    * Must use forward slash with the method of ServletContext
* Calling forward() on a RequestDispatcher
    * view.forward(request, response)
    
## What's wrong with this code?
* You can't forward the request if you've already committed a response (i.e sent the response to the client)
